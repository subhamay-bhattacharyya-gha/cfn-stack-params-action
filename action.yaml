name: 'CloudFormation Configuration Processor'
description: 'Process CloudFormation deployment configurations and generate parameters, stack names, and CI build identifiers'
author: 'GitHub'
branding:
  icon: 'cloud'
  color: 'orange'

inputs:
  cfn-directory:
    description: 'Folder containing CloudFormation configuration files'
    required: false
    default: 'cfn'
  ci-build:
    description: 'Whether this is a CI build (true/false)'
    required: false
    default: 'false'
  environment:
    description: 'Target environment name'
    required: false
    default: ''

outputs:
  parameters:
    description: 'JSON array of CloudFormation parameters'
    value: ${{ steps.process-config.outputs.parameters }}
  stack-name:
    description: 'Generated CloudFormation stack name'
    value: ${{ steps.process-config.outputs.stack-name }}

runs:
  using: 'composite'
  steps:
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      shell: bash
      run: npm install
      working-directory: ${{ github.action_path }}

    - name: Run CloudFormation Configuration Processor
      id: process-config
      shell: bash
      run: node ${{ github.action_path }}/src/main.js
      env:
        INPUT_CFN_DIRECTORY: ${{ inputs.cfn-directory }}
        INPUT_CI_BUILD: ${{ inputs.ci-build }}
        INPUT_ENVIRONMENT: ${{ inputs.environment }}